{{define "content"}}
<!-- Changelog Header -->
<header>
  <h1 id="title">
    <i class="bi bi-journal-text"></i> Changelog
  </h1>
  <p>
    Track all changes, improvements, and updates to this project. Filter by version, 
    change type, or search for specific features and fixes.
  </p>
</header>

<!-- Changelog Stats -->
<section id="changelog-stats" class="mb-4">
  <div class="row">
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="bi bi-tags"></i>
        </div>
        <div class="stat-content">
          <h3>{{.Page.Data.Stats.TotalVersions}}</h3>
          <p>Versions</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="bi bi-list-check"></i>
        </div>
        <div class="stat-content">
          <h3>{{.Page.Data.Stats.TotalChanges}}</h3>
          <p>Total Changes</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="bi bi-calendar-event"></i>
        </div>
        <div class="stat-content">
          <h3>{{.Page.Data.Stats.DateRange.From.Format "Jan 2006"}}</h3>
          <p>First Release</p>
        </div>
      </div>
    </div>
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="bi bi-star"></i>
        </div>
        <div class="stat-content">
          <h3>{{.Page.Data.Stats.LatestVersion}}</h3>
          <p>Latest Version</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Filters and Controls -->
<section id="changelog-controls" class="mb-4">
  <div class="controls-container">
    <!-- Search -->
    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="bi bi-search search-icon"></i>
        <input
          type="text"
          id="changelogSearch"
          class="search-input"
          placeholder="Search changelog entries... (Ctrl+K to focus)"
          value="{{.Page.Data.Filter.Search}}"
          autocomplete="off"
        />
        <button class="search-clear" id="searchClear" style="display: none">
          <i class="bi bi-x"></i>
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="filter-controls">
      <div class="filter-group">
        <label for="versionFilter" class="filter-label">Version:</label>
        <select id="versionFilter" class="filter-select">
          <option value="">All Versions</option>
          {{range .Page.Data.Versions}}
          <option value="{{.}}" {{if eq $.Page.Data.Filter.Version .}}selected{{end}}>{{.}}</option>
          {{end}}
        </select>
      </div>

      <div class="filter-group">
        <label for="typeFilter" class="filter-label">Change Type:</label>
        <select id="typeFilter" class="filter-select">
          <option value="">All Types</option>
          {{range .Page.Data.ChangeTypes}}
          <option value="{{.}}" {{if eq $.Page.Data.Filter.ChangeType .}}selected{{end}}>{{.}}</option>
          {{end}}
        </select>
      </div>

      <div class="filter-group">
        <label for="dateFromFilter" class="filter-label">From Date:</label>
        <input
          type="date"
          id="dateFromFilter"
          class="filter-input"
          value="{{if not .Page.Data.Filter.DateFrom.IsZero}}{{.Page.Data.Filter.DateFrom.Format "2006-01-02"}}{{end}}"
        />
      </div>

      <div class="filter-group">
        <label for="dateToFilter" class="filter-label">To Date:</label>
        <input
          type="date"
          id="dateToFilter"
          class="filter-input"
          value="{{if not .Page.Data.Filter.DateTo.IsZero}}{{.Page.Data.Filter.DateTo.Format "2006-01-02"}}{{end}}"
        />
      </div>

      <div class="filter-group">
        <label class="filter-checkbox-label">
          <input
            type="checkbox"
            id="showUnreleasedFilter"
            class="filter-checkbox"
            {{if .Page.Data.Filter.ShowUnreleased}}checked{{end}}
          />
          <span class="checkmark"></span>
          Show Unreleased
        </label>
      </div>

      <button class="filter-reset" id="filterReset">
        <i class="bi bi-arrow-clockwise"></i> Reset Filters
      </button>
    </div>

    <!-- Export Options -->
    <div class="export-controls">
      <div class="export-buttons">
        <a href="/changelog.json" class="export-btn" target="_blank">
          <i class="bi bi-download"></i> JSON
        </a>
        <a href="/changelog.rss" class="export-btn" target="_blank">
          <i class="bi bi-rss"></i> RSS
        </a>
        <a href="/changelog.md" class="export-btn" target="_blank">
          <i class="bi bi-file-text"></i> Markdown
        </a>
        <a href="/changelog.md?format=html" class="export-btn" target="_blank">
          <i class="bi bi-file-earmark-code"></i> HTML
        </a>
      </div>
    </div>

    <!-- Results Info -->
    <div class="results-info">
      <span id="resultsCount">Showing {{.Page.Data.Changelog.Total}} changelog entries</span>
      <div class="view-toggle">
        <button id="viewToggle" class="view-toggle-btn" data-view="timeline">
          <i class="bi bi-list-ul"></i> Timeline View
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Changelog Entries -->
<section id="changelog-content">
  <div id="changelog-entries">
    {{range .Page.Data.Changelog.Entries}}
    <div class="changelog-entry" data-version="{{.Version}}" data-date="{{.Date.Format "2006-01-02"}}">
      <div class="entry-header">
        <div class="version-info">
          <h2 class="version-title">
            <span class="version-number">{{.Version}}</span>
            {{if not .IsUnreleased}}
            <span class="version-date">{{.Date.Format "January 2, 2006"}}</span>
            {{else}}
            <span class="version-date unreleased" style="color: var(--orange); font-weight: 500;">Unreleased</span>
            {{end}}
          </h2>
          <div class="version-badges">
            {{if .IsUnreleased}}
            <span class="badge unreleased-badge" style="background: var(--orange); color: var(--bg);">Unreleased</span>
            {{end}}
            <span class="badge changes-count">{{len .Changes}} changes</span>
          </div>
        </div>
        <div class="entry-actions">
          <button class="action-btn" onclick="copyVersionLink('{{.Version}}')" title="Copy version link">
            <i class="bi bi-link-45deg"></i>
          </button>
          <button class="action-btn" onclick="toggleEntry('{{.Version}}')" title="Toggle entry">
            <i class="bi bi-chevron-down"></i>
          </button>
        </div>
      </div>

      <div class="entry-content" id="content-{{.Version}}">
        {{range .Changes}}
        <div class="change-section" data-type="{{.Type}}">
          <h3 class="change-type {{.Type}}">
            <i class="bi bi-{{if eq .Type "Added"}}plus-circle{{else if eq .Type "Changed"}}arrow-repeat{{else if eq .Type "Fixed"}}bug{{else if eq .Type "Removed"}}dash-circle{{else if eq .Type "Security"}}shield-check{{else if eq .Type "Deprecated"}}exclamation-triangle{{else}}info-circle{{end}}"></i>
            {{.Type}}
          </h3>
          <ul class="change-list">
            {{range .Items}}
            <li class="change-item">{{.}}</li>
            {{end}}
          </ul>
        </div>
        {{end}}
      </div>
    </div>
    {{end}}
  </div>

  <!-- Empty State -->
  <div id="empty-state" class="empty-state" style="display: none;">
    <div class="empty-icon">
      <i class="bi bi-search"></i>
    </div>
    <h3>No changelog entries found</h3>
    <p>Try adjusting your filters or search terms to find what you're looking for.</p>
    <button class="btn btn-primary" onclick="resetFilters()">
      <i class="bi bi-arrow-clockwise"></i> Reset Filters
    </button>
  </div>
</section>

<!-- Change Type Legend -->
<section id="changelog-legend" class="mt-4">
  <div class="legend-container">
    <h4>Change Types</h4>
    <div class="legend-items">
      <div class="legend-item">
        <span class="legend-icon Added"><i class="bi bi-plus-circle"></i></span>
        <span class="legend-label">Added</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon Changed"><i class="bi bi-arrow-repeat"></i></span>
        <span class="legend-label">Changed</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon Fixed"><i class="bi bi-bug"></i></span>
        <span class="legend-label">Fixed</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon Removed"><i class="bi bi-dash-circle"></i></span>
        <span class="legend-label">Removed</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon Security"><i class="bi bi-shield-check"></i></span>
        <span class="legend-label">Security</span>
      </div>
      <div class="legend-item">
        <span class="legend-icon Deprecated"><i class="bi bi-exclamation-triangle"></i></span>
        <span class="legend-label">Deprecated</span>
      </div>
    </div>
  </div>
</section>

<style>
  /* Stats Cards */
  .stat-card {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
    height: 100%;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px var(--shadow);
    border-color: var(--aqua);
  }

  .stat-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--blue), var(--aqua));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .stat-content h3 {
    color: var(--yellow);
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
    line-height: 1;
  }

  .stat-content p {
    color: var(--fg-secondary);
    margin: 0.25rem 0 0 0;
    font-size: 0.9rem;
    font-weight: 500;
  }

  /* Controls Container */
  .controls-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 12px var(--shadow);
  }

  /* Search */
  .search-container {
    margin-bottom: 2rem;
  }

  .search-input-wrapper {
    position: relative;
    max-width: 600px;
    margin: 0 auto;
  }

  .search-input {
    width: 100%;
    padding: 1rem 3rem 1rem 3rem;
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--fg);
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px var(--shadow);
  }

  .search-input:focus {
    outline: none;
    border-color: var(--aqua);
    box-shadow: 0 4px 16px rgba(104, 157, 106, 0.2);
  }

  .search-input::placeholder {
    color: var(--gray);
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--blue);
    font-size: 1.2rem;
    pointer-events: none;
  }

  .search-clear {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--gray);
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .search-clear:hover {
    background: var(--border);
    color: var(--red);
    border-color: var(--red);
  }

  /* Filter Controls */
  .filter-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    align-items: end;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .filter-label {
    color: var(--yellow);
    font-weight: 500;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .filter-select,
  .filter-input {
    padding: 0.75rem 1rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--fg);
    font-size: 0.9rem;
    font-family: inherit;
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .filter-select:focus,
  .filter-input:focus {
    outline: none;
    border-color: var(--aqua);
    box-shadow: 0 0 0 2px rgba(104, 157, 106, 0.2);
  }

  .filter-select option {
    background: var(--bg);
    color: var(--fg);
  }

  .filter-checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    color: var(--fg);
    font-size: 0.9rem;
  }

  .filter-checkbox {
    display: none;
  }

  .checkmark {
    width: 20px;
    height: 20px;
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 4px;
    position: relative;
    transition: all 0.2s ease;
  }

  .filter-checkbox:checked + .checkmark {
    background: var(--aqua);
    border-color: var(--aqua);
  }

  .filter-checkbox:checked + .checkmark::after {
    content: "✓";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--bg);
    font-size: 0.8rem;
    font-weight: bold;
  }

  .filter-reset {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--fg);
    font-size: 0.9rem;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .filter-reset:hover {
    background: var(--border);
    color: var(--aqua);
    border-color: var(--aqua);
  }

  /* Export Controls */
  .export-controls {
    margin-bottom: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
  }

  .export-buttons {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .export-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .export-btn:hover {
    background: var(--border);
    color: var(--aqua);
    border-color: var(--aqua);
    transform: translateY(-1px);
  }

  /* Results Info */
  .results-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }

  .results-info span {
    color: var(--gray);
    font-size: 0.9rem;
    font-weight: 500;
  }

  .view-toggle-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .view-toggle-btn:hover {
    background: var(--border);
    color: var(--aqua);
    border-color: var(--aqua);
  }

  /* Changelog Entries */
  .changelog-entry {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 2rem;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .changelog-entry:hover {
    border-color: var(--aqua);
    box-shadow: 0 8px 25px var(--shadow);
  }

  .entry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
  }

  .version-info {
    flex: 1;
  }

  .version-title {
    margin: 0 0 0.5rem 0;
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .version-number {
    color: var(--yellow);
    font-size: 1.5rem;
    font-weight: 700;
  }

  .version-date {
    color: var(--gray);
    font-size: 1rem;
    font-weight: 400;
  }

  .version-date.unreleased {
    color: var(--orange);
    font-weight: 500;
  }

  .version-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .badge {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .unreleased-badge {
    background: var(--orange);
    color: var(--bg);
  }

  .changes-count {
    background: var(--bg-secondary);
    color: var(--fg);
    border: 1px solid var(--border);
  }

  .entry-actions {
    display: flex;
    gap: 0.5rem;
  }

  .action-btn {
    width: 2.5rem;
    height: 2.5rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .action-btn:hover {
    background: var(--border);
    color: var(--aqua);
    border-color: var(--aqua);
  }

  .entry-content {
    padding: 1.5rem;
  }

  .change-section {
    margin-bottom: 2rem;
  }

  .change-section:last-child {
    margin-bottom: 0;
  }

  .change-type {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    font-size: 1.2rem;
    font-weight: 600;
  }

  .change-type.Added {
    color: var(--green);
  }

  .change-type.Changed {
    color: var(--blue);
  }

  .change-type.Fixed {
    color: var(--red);
  }

  .change-type.Removed {
    color: var(--orange);
  }

  .change-type.Security {
    color: var(--purple);
  }

  .change-type.Deprecated {
    color: var(--yellow);
  }

  .change-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .change-item {
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border);
    color: var(--fg);
    line-height: 1.6;
  }

  .change-item:last-child {
    border-bottom: none;
  }

  .change-item::before {
    content: "•";
    color: var(--aqua);
    font-weight: bold;
    margin-right: 0.75rem;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 12px;
  }

  .empty-icon {
    font-size: 4rem;
    color: var(--gray);
    margin-bottom: 1rem;
  }

  .empty-state h3 {
    color: var(--fg);
    margin-bottom: 1rem;
  }

  .empty-state p {
    color: var(--fg-secondary);
    margin-bottom: 2rem;
  }

  /* Legend */
  .legend-container {
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
  }

  .legend-container h4 {
    color: var(--yellow);
    margin-bottom: 1rem;
    font-size: 1.1rem;
  }

  .legend-items {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .legend-icon {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
  }

  .legend-icon.Added {
    background: var(--green);
    color: var(--bg);
  }

  .legend-icon.Changed {
    background: var(--blue);
    color: var(--bg);
  }

  .legend-icon.Fixed {
    background: var(--red);
    color: var(--bg);
  }

  .legend-icon.Removed {
    background: var(--orange);
    color: var(--bg);
  }

  .legend-icon.Security {
    background: var(--purple);
    color: var(--bg);
  }

  .legend-icon.Deprecated {
    background: var(--yellow);
    color: var(--bg);
  }

  .legend-label {
    color: var(--fg);
    font-size: 0.9rem;
    font-weight: 500;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .controls-container {
      padding: 1.5rem;
    }

    .search-input {
      padding: 0.875rem 2.5rem 0.875rem 2.5rem;
      font-size: 0.95rem;
    }

    .search-icon {
      left: 0.875rem;
      font-size: 1.1rem;
    }

    .search-clear {
      right: 0.875rem;
      width: 1.75rem;
      height: 1.75rem;
    }

    .filter-controls {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .filter-reset {
      justify-content: center;
      padding: 0.875rem 1rem;
    }

    .export-buttons {
      justify-content: center;
    }

    .results-info {
      flex-direction: column;
      gap: 1rem;
      align-items: stretch;
    }

    .entry-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .entry-actions {
      align-self: flex-end;
    }

    .version-title {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .legend-items {
      justify-content: center;
    }
  }

  @media (max-width: 480px) {
    .stat-card {
      padding: 1rem;
    }

    .stat-content h3 {
      font-size: 1.5rem;
    }

    .version-number {
      font-size: 1.3rem;
    }

    .change-type {
      font-size: 1.1rem;
    }

    .empty-state {
      padding: 2rem 1rem;
    }

    .empty-icon {
      font-size: 3rem;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get all elements
    const searchInput = document.getElementById("changelogSearch");
    const searchClear = document.getElementById("searchClear");
    const versionFilter = document.getElementById("versionFilter");
    const typeFilter = document.getElementById("typeFilter");
    const dateFromFilter = document.getElementById("dateFromFilter");
    const dateToFilter = document.getElementById("dateToFilter");
    const showUnreleasedFilter = document.getElementById("showUnreleasedFilter");
    const filterReset = document.getElementById("filterReset");
    const resultsCount = document.getElementById("resultsCount");
    const viewToggle = document.getElementById("viewToggle");
    const changelogEntries = document.getElementById("changelog-entries");
    const emptyState = document.getElementById("empty-state");

    // Store original entries for reset functionality
    const originalEntries = Array.from(changelogEntries.children);

    // Function to update results count
    function updateResultsCount(visibleCount) {
      const totalCount = originalEntries.length;
      if (visibleCount === totalCount) {
        resultsCount.textContent = `Showing all ${totalCount} changelog entries`;
      } else {
        resultsCount.textContent = `Showing ${visibleCount} of ${totalCount} changelog entries`;
      }
    }

    // Function to check if an entry matches the current filters
    function entryMatchesFilters(entry) {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const versionValue = versionFilter.value;
      const typeValue = typeFilter.value;
      const dateFromValue = dateFromFilter.value;
      const dateToValue = dateToFilter.value;
      const showUnreleased = showUnreleasedFilter.checked;

      // Get entry data
      const version = entry.dataset.version;
      const date = entry.dataset.date;
      const isUnreleased = version === "Unreleased";

      // Filter by unreleased
      if (isUnreleased && !showUnreleased) {
        return false;
      }

      // Filter by version
      if (versionValue && !version.toLowerCase().includes(versionValue.toLowerCase())) {
        return false;
      }

      // Filter by date range
      if (dateFromValue && date && date < dateFromValue) {
        return false;
      }
      if (dateToValue && date && date > dateToValue) {
        return false;
      }

      // Filter by change type
      if (typeValue) {
        const changeSections = entry.querySelectorAll('.change-section');
        let hasMatchingType = false;
        changeSections.forEach(section => {
          if (section.dataset.type.toLowerCase() === typeValue.toLowerCase()) {
            hasMatchingType = true;
          }
        });
        if (!hasMatchingType) {
          return false;
        }
      }

      // Search filter
      if (searchTerm) {
        const text = entry.textContent.toLowerCase();
        if (!text.includes(searchTerm)) {
          return false;
        }
      }

      return true;
    }

    // Function to filter and display entries
    function filterEntries() {
      let visibleCount = 0;

      originalEntries.forEach(entry => {
        const matches = entryMatchesFilters(entry);

        if (matches) {
          entry.style.display = "block";
          entry.style.opacity = "1";
          visibleCount++;
        } else {
          entry.style.display = "none";
          entry.style.opacity = "0";
        }
      });

      // Show/hide empty state
      if (visibleCount === 0) {
        emptyState.style.display = "block";
        changelogEntries.style.display = "none";
      } else {
        emptyState.style.display = "none";
        changelogEntries.style.display = "block";
      }

      updateResultsCount(visibleCount);
    }

    // Search input event listener
    searchInput.addEventListener("input", function () {
      if (this.value.trim()) {
        searchClear.style.display = "block";
      } else {
        searchClear.style.display = "none";
      }
      filterEntries();
    });

    // Search clear button
    searchClear.addEventListener("click", function () {
      searchInput.value = "";
      this.style.display = "none";
      filterEntries();
    });

    // Filter change event listeners
    [versionFilter, typeFilter, dateFromFilter, dateToFilter, showUnreleasedFilter].forEach(filter => {
      filter.addEventListener("change", filterEntries);
    });

    // Reset filters button
    filterReset.addEventListener("click", function () {
      searchInput.value = "";
      searchClear.style.display = "none";
      versionFilter.value = "";
      typeFilter.value = "";
      dateFromFilter.value = "";
      dateToFilter.value = "";
      showUnreleasedFilter.checked = true;
      filterEntries();
    });

    // View toggle functionality
    viewToggle.addEventListener("click", function () {
      const currentView = this.dataset.view;
      const newView = currentView === "timeline" ? "compact" : "timeline";
      
      this.dataset.view = newView;
      
      if (newView === "compact") {
        this.innerHTML = '<i class="bi bi-list"></i> Compact View';
        changelogEntries.classList.add("compact-view");
      } else {
        this.innerHTML = '<i class="bi bi-list-ul"></i> Timeline View';
        changelogEntries.classList.remove("compact-view");
      }
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", function (e) {
      // Focus search input with Ctrl+K or Cmd+K
      if ((e.ctrlKey || e.metaKey) && e.key === "k") {
        e.preventDefault();
        searchInput.focus();
      }

      // Clear search with Escape
      if (e.key === "Escape" && document.activeElement === searchInput) {
        searchInput.value = "";
        searchClear.style.display = "none";
        filterEntries();
      }
    });

    // Initial filter
    filterEntries();

    // Add smooth transitions
    originalEntries.forEach(entry => {
      entry.style.transition = "opacity 0.3s ease, transform 0.3s ease";
    });
  });

  // Global functions
  function copyVersionLink(version) {
    const url = window.location.origin + window.location.pathname + "#" + version;
    navigator.clipboard.writeText(url).then(() => {
      // Show feedback
      const btn = event.target.closest('.action-btn');
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<i class="bi bi-check"></i>';
      btn.style.color = 'var(--green)';
      
      setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.style.color = '';
      }, 2000);
    });
  }

  function toggleEntry(version) {
    const content = document.getElementById('content-' + version);
    const btn = event.target.closest('.action-btn');
    const icon = btn.querySelector('i');
    
    if (content.style.display === 'none') {
      content.style.display = 'block';
      icon.className = 'bi bi-chevron-down';
    } else {
      content.style.display = 'none';
      icon.className = 'bi bi-chevron-right';
    }
  }

  function resetFilters() {
    document.getElementById('filterReset').click();
  }

  // Handle URL hash for direct linking to versions
  window.addEventListener('load', function() {
    const hash = window.location.hash.substring(1);
    if (hash) {
      const entry = document.querySelector(`[data-version="${hash}"]`);
      if (entry) {
        entry.scrollIntoView({ behavior: 'smooth', block: 'start' });
        entry.style.border = '2px solid var(--aqua)';
        setTimeout(() => {
          entry.style.border = '';
        }, 3000);
      }
    }
  });
</script>
{{end}}
